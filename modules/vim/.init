#!/usr/bin/env sh

export NVIM_HOME="$(dirname "$0")"
export LOG_NAMESPACE="î˜« nvim"
export LOG_LEVEL=info

NVIM_LOCAL="$NVIM_HOME/.local"
if [ -n "$HMVC_SHOULD_UPGRADE" ]; then
  mkdir -p "$NVIM_LOCAL"
  git-download "folke/lazy.nvim" "$NVIM_LOCAL/lazy.nvim"
fi

# Required by the nvim lua config
export NVIM_LAZY_HOME="$NVIM_LOCAL/lazy.nvim"

# Check if ~/.config/nvim is setup correctly
real="$NVIM_HOME/config"
fake="$HOME/.config/nvim"

if is_symlink_broken "$fake"; then
  fancy-log warn -v path "$fake" \
    "Removing broken config symlink ..."

  rm "$fake"
fi

if [ ! -d "$fake" ]; then
  fancy-log info -v real "$real" -v fake "$fake" \
    "Creating config symlink ..."

  ln -s "$real" "$fake"
fi
